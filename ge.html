<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Grims Shop</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            text-align: center;
            background-color: #f0f0f0;
        }
        #shop, #collection {
            display: none;
        }
        #shop img {
            cursor: pointer;
            width: 100px;
            height: 100px;
        }
        #collection img {
            width: 100px;
            height: 100px;
        }
        #grimsDisplay {
            font-size: 24px;
            margin-top: 20px;
        }
    </style>
</head>
<body>
    <audio id="backgroundMusic" src="https://noampro900.github.io/data5555555555/Brawl%20Stars%20OST.mp3" loop autoplay hidden></audio>

    <h1>Welcome!</h1>
    <div id="grimsDisplay">Grims: <span id="grims">0</span></div>
    
    <div id="shop">
        <h2>Shop</h2>
        <img id="item" src="https://noampro900.github.io/data5555555555/%D7%97%D7%A1%D7%A8%20%D7%9B%D7%95%D7%AA%D7%A8%D7%AA149_20240922011550%20(2).png" alt="Item">
        <p id="purchaseMessage"></p>

        <!-- Promo Code Section -->
        <div id="promoCodeSection">
            <h3>Enter Promo Code</h3>
            <input type="text" id="promoCodeInput" placeholder="Enter your promo code">
            <button id="redeemButton">Redeem Code</button>
            <p id="promoMessage"></p>
        </div>

        <!-- Existing 5 Free Grims Offer -->
        <img id="freeGrims" src="https://noampro900.github.io/data5555555555/20240922_022343.gif" alt="Get 5 Free Grims" width="200px" height="200px">
        <p id="freeGrimsMessage"></p>

        <!-- Existing 15 Free Grims Offer -->
        <img id="limitedOfferGrims" src="https://noampro900.github.io/data5555555555/20240922_073524.gif" alt="Get 15 Free Grims" width="200px" height="200px">
        <p id="limitedOfferMessage"></p>

        <!-- New 1 Free Grim Offer -->
        <img id="oneFreeGrim" src="https://noampro900.github.io/data5555555555/%D7%97%D7%A1%D7%A8%20%D7%9B%D7%95%D7%AA%D7%A8%D7%AA161_20240924125431.png" alt="Get 1 Free Grim" width="200px" height="200px">
        <p id="oneFreeGrimMessage"></p>

        <!-- New limited-time picture purchase offer -->
        <img id="limitedPictureOffer" src="https://noampro900.github.io/data5555555555/%D7%97%D7%A1%D7%A8%20%D7%9B%D7%95%D7%AA%D7%A8%D7%AA162_20240924131217.png" alt="Limited Time Picture" width="200px" height="200px" style="display:none;">
        <p id="limitedPictureMessage"></p>
    </div>
    
    <button id="myCollectionBtn">My Collection</button>

    <div id="collection">
        <h2>Your Collection</h2>
        <div id="collectionImages">
            <!-- Images will be shown here -->
        </div>
        <button id="backToShopBtn">Back to Shop</button>
    </div>

    <script>
        // Grims counter
        let grims = parseInt(localStorage.getItem('grims')) || 0;
        document.getElementById('grims').textContent = grims;

        // Collection
        let collection = JSON.parse(localStorage.getItem('collection')) || [];

        // Promo code redemption statuses (stored in localStorage)
        let promoCodesRedeemed = JSON.parse(localStorage.getItem('promoCodesRedeemed')) || {};

        // Function to save redeemed status
        function saveRedeemedStatus(code) {
            promoCodesRedeemed[code] = true;
            localStorage.setItem('promoCodesRedeemed', JSON.stringify(promoCodesRedeemed));
        }

        // Promo code functionality
        document.getElementById('redeemButton').addEventListener('click', function() {
            const promoCode = document.getElementById('promoCodeInput').value;
            let message = '';

            // Check if the promo code was already redeemed
            if (promoCodesRedeemed[promoCode]) {
                message = 'This promo code has already been redeemed.';
            } else {
                if (promoCode === 'ilovethisgame') {
                    grims += 100;
                    message = 'Promo code applied! You received 100 Grims!';
                    saveRedeemedStatus(promoCode);  // Mark as redeemed
                } else if (promoCode === 'wonbscode--4455pok2po232345') {
                    grims += 2;
                    message = 'Promo code applied! You received 2 Grims!';
                    saveRedeemedStatus(promoCode);  // Mark as redeemed
                } else if (promoCode === 'wonbscode--659oo874534857oo') {
                    grims += 2;
                    message = 'Promo code applied! You received 2 Grims!';
                    saveRedeemedStatus(promoCode);  // Mark as redeemed
                } else {
                    message = 'Invalid promo code. Please try again.';
                }
            }

            document.getElementById('grims').textContent = grims;
            localStorage.setItem('grims', grims);
            document.getElementById('promoMessage').textContent = message;
        });

        // Update grims every 7 minutes (420,000 ms)
        setInterval(function() {
            grims += 2;
            document.getElementById('grims').textContent = grims;
            localStorage.setItem('grims', grims); // Save to localStorage
        }, 420000); // 7 minutes in milliseconds

        // Display shop initially
        document.getElementById('shop').style.display = 'block';

        // Clicking on item to purchase
        document.getElementById('item').addEventListener('click', function() {
            if (grims >= 8) {
                grims -= 8;
                document.getElementById('grims').textContent = grims;
                document.getElementById('purchaseMessage').textContent = "Purchase succeed!";
                collection.push('https://noampro900.github.io/data5555555555/%D7%97%D7%A1%D7%A8%20%D7%9B%D7%95%D7%AA%D7%A8%D7%AA149_20240922011550%20(1).png');
                localStorage.setItem('collection', JSON.stringify(collection)); // Save collection to localStorage
                localStorage.setItem('grims', grims); // Update grims in localStorage
            } else {
                document.getElementById('purchaseMessage').textContent = "Not enough grims!";
            }
        });

        // Show collection
        document.getElementById('myCollectionBtn').addEventListener('click', function() {
            document.getElementById('shop').style.display = 'none';
            document.getElementById('collection').style.display = 'block';
            const collectionDiv = document.getElementById('collectionImages');
            collectionDiv.innerHTML = '';
            collection.forEach(imagePath => {
                const img = document.createElement('img');
                img.src = imagePath;
                collectionDiv.appendChild(img);
            });
        });

        // Back to shop
        document.getElementById('backToShopBtn').addEventListener('click', function() {
            document.getElementById('collection').style.display = 'none';
            document.getElementById('shop').style.display = 'block';
        });

        // Handle free grims one-time offer (5 Grims)
        document.getElementById('freeGrims').addEventListener('click', function() {
            if (!localStorage.getItem('hasClaimedFreeGrims')) {
                grims += 5;
                document.getElementById('grims').textContent = grims;
                localStorage.setItem('grims', grims); // Save to localStorage
                document.getElementById('freeGrimsMessage').textContent = "You received 5 grims!";
                localStorage.setItem('hasClaimedFreeGrims', 'true'); // Mark offer as claimed
                document.getElementById('freeGrims').style.display = 'none'; // Hide free grims image
            } else {
                document.getElementById('freeGrimsMessage').textContent = "You have already claimed your free grims!";
            }
        });

        // Handle limited-time free 15 grims offer
        document.getElementById('limitedOfferGrims').addEventListener('click', function() {
            let now = new Date().getTime();
            if (!localStorage.getItem('hasClaimedLimitedOffer')) {
                if (now <= offerDeadline) {
                    grims += 15;
                    document.getElementById('grims').textContent = grims;
                    localStorage.setItem('grims', grims); // Save to localStorage
                    document.getElementById('limitedOfferMessage').textContent = "You received 15 grims!";
                    localStorage.setItem('hasClaimedLimitedOffer', 'true'); // Mark offer as claimed
                    document.getElementById('limitedOfferGrims').style.display = 'none'; // Hide free grims image
                } else {
                    document.getElementById('limitedOfferMessage').textContent = "The offer has expired!";
                    document.getElementById('limitedOfferGrims').style.display = 'none'; // Hide the offer image
                }
            } else {
                document.getElementById('limitedOfferMessage').textContent = "You have already claimed your free grims!";
            }
        });

        // Handle limited-time 1 free Grim offer
        document.getElementById('oneFreeGrim').addEventListener('click', function() {
            let now = new Date().getTime();
            if (!localStorage.getItem('hasClaimedOneFreeGrim')) {
                if (now <= oneFreeGrimDeadline) {
                    grims += 1;
                    document.getElementById('grims').textContent = grims;
                    localStorage.setItem('grims', grims); // Save to localStorage
                    document.getElementById('oneFreeGrimMessage').textContent = "You received 1 Grim!";
                    localStorage.setItem('hasClaimedOneFreeGrim', 'true'); // Mark offer as claimed
                    document.getElementById('oneFreeGrim').style.display = 'none'; // Hide free Grim image
                } else {
                    document.getElementById('oneFreeGrimMessage').textContent = "The offer has expired!";
                    document.getElementById('oneFreeGrim').style.display = 'none'; // Hide the offer image
                }
            } else {
                document.getElementById('oneFreeGrimMessage').textContent = "You have already claimed your free Grim!";
            }
        });

        // Handle limited-time picture offer
        function checkLimitedPictureOffer() {
            let now = new Date().getTime();
            if (!localStorage.getItem('hasPurchasedLimitedPicture') && now >= limitedPictureStart && now <= limitedPictureEnd) {
                document.getElementById('limitedPictureOffer').style.display = 'block'; // Show the offer image
            } else {
                document.getElementById('limitedPictureOffer').style.display = 'none'; // Hide if expired
            }
        }

        document.getElementById('limitedPictureOffer').addEventListener('click', function() {
            let now = new Date().getTime();
            if (!localStorage.getItem('hasPurchasedLimitedPicture') && now >= limitedPictureStart && now <= limitedPictureEnd) {
                if (grims >= 1) {
                    grims -= 1;
                    document.getElementById('grims').textContent = grims;
                    localStorage.setItem('grims', grims); // Save to localStorage
                    document.getElementById('limitedPictureMessage').textContent = "You purchased the picture!";
                    collection.push('https://noampro900.github.io/data5555555555/20240924_130927.jpg'); // Add picture to collection
                    localStorage.setItem('collection', JSON.stringify(collection)); // Save collection
                    localStorage.setItem('hasPurchasedLimitedPicture', 'true'); // Mark as purchased
                    document.getElementById('limitedPictureOffer').style.display = 'none'; // Hide offer image
                } else {
                    document.getElementById('limitedPictureMessage').textContent = "Not enough grims!";
                }
            } else if (now > limitedPictureEnd) {
                document.getElementById('limitedPictureMessage').textContent = "The offer has expired!";
            }
        });

        // Check the picture offer on page load and at intervals
        checkLimitedPictureOffer();
        setInterval(checkLimitedPictureOffer, 60000); // Check every minute

        // Hide free grims image if already claimed
        if (localStorage.getItem('hasClaimedFreeGrims')) {
            document.getElementById('freeGrims').style.display = 'none';
        }

        // Hide limited-time offer if already claimed or expired
        if (localStorage.getItem('hasClaimedLimitedOffer') || new Date().getTime() > offerDeadline) {
            document.getElementById('limitedOfferGrims').style.display = 'none';
        }

        // Hide 1 free Grim image if already claimed or expired
        if (localStorage.getItem('hasClaimedOneFreeGrim') || new Date().getTime() > oneFreeGrimDeadline) {
            document.getElementById('oneFreeGrim').style.display = 'none';
        }

        // Load collection on page load
        window.onload = function() {
            const collectionDiv = document.getElementById('collectionImages');
            collectionDiv.innerHTML = '';
            collection.forEach(imagePath => {
                const img = document.createElement('img');
                img.src = imagePath;
                collectionDiv.appendChild(img);
            });
        };
    </script>
</body>
</html>
