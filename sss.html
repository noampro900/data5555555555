<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>NFC Card Match</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body {
    margin: 0;
    font-family: Arial, sans-serif;
    background: radial-gradient(circle at top, #111, #000);
    color: white;
    text-align: center;
}

h1 {
    margin-top: 30px;
}

#box {
    margin: 30px auto;
    width: 90%;
    max-width: 420px;
    padding: 25px;
    background: #111;
    border-radius: 18px;
    box-shadow: 0 0 20px #0ff;
}

button {
    background: #0ff;
    border: none;
    padding: 14px 24px;
    font-size: 18px;
    border-radius: 10px;
    cursor: pointer;
    margin-top: 15px;
}

#status {
    margin-top: 20px;
    font-size: 18px;
}

.ok { color: #0f0; }
.err { color: #f33; }

#game {
    display: none;
    margin-top: 25px;
    font-size: 22px;
    color: #0f0;
}
</style>
</head>

<body>

<h1>NFC ACCESS SYSTEM</h1>

<div id="box">
    <p>Tap NFC card to continue</p>
    <button onclick="scanNFC()">Scan NFC</button>
    <div id="status">Waiting‚Ä¶</div>
</div>

<div id="game">
    üéÆ GAME UNLOCKED<br>
    Enjoy!
</div>

<script>
let cards = [];

// Load cards.txt
fetch("https://noampro900.github.io/data5555555555/cards.txt")
    .then(r => r.text())
    .then(t => {
        cards = t
            .split("\n")
            .map(l => l.trim())
            .filter(l => l.length > 0);
        console.log("Loaded cards:", cards);
    });

async function scanNFC() {
    if (!("NDEFReader" in window)) {
        setStatus("NFC not supported", "err");
        return;
    }

    try {
        const reader = new NDEFReader();
        await reader.scan();
        setStatus("Hold card near phone‚Ä¶");

        reader.onreading = (event) => {
            const scannedSerial = event.serialNumber.toUpperCase();
            console.log("Scanned:", scannedSerial);

            // üî• CORRECT MATCH LOGIC
            const matchLine = cards.find(line => {
                const fileSerial = line.split("|")[0].toUpperCase();
                return fileSerial === scannedSerial;
            });

            if (!matchLine) {
                setStatus("‚ùå Card not recognized", "err");
                return;
            }

            const parts = matchLine.split("|");
            const mol = Number(parts[1]);
            const tickets = Number(parts[2]);

            if (mol <= 2) {
                setStatus("‚ùå Not enough MOL coins", "err");
                return;
            }

            setStatus(
                `‚úÖ Card accepted<br>MOL: ${mol} | Tickets: ${tickets}`,
                "ok"
            );
            unlockGame();
        };

    } catch (e) {
        setStatus("‚ùå Permission denied or scan failed", "err");
    }
}

function unlockGame() {
    document.getElementById("game").style.display = "block";
}

function setStatus(text, cls) {
    const el = document.getElementById("status");
    el.innerHTML = text;
    el.className = cls || "";
}
</script>

</body>
</html>
